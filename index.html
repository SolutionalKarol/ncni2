<div id="ncni-widget-container" style="font-family: 'Inter', sans-serif; z-index: 10000; position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; align-items: flex-end;">
    
  <button id="ncni-toggle-btn" style="background: #0F766E; border: none; width: 65px; height: 65px; border-radius: 50%; box-shadow: 0 10px 25px rgba(15, 118, 110, 0.5); cursor: pointer; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; align-items: center; justify-content: center; padding: 0; overflow: hidden; border: 3px solid white;">
      <img src="ania.jpg" alt="Ania AI Asystent" style="width: 100%; height: 100%; object-fit: cover;">
  </button>

  <div id="ncni-chat-window" style="display: none; width: 350px; height: 550px; background: rgba(255, 255, 255, 0.98); border: 1px solid #E2E8F0; border-radius: 18px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.2); margin-bottom: 16px; flex-direction: column; transform-origin: bottom right; transition: all 0.3s ease;">
      
      <div style="background: #0F766E; padding: 15px; color: white; display: flex; align-items: center; justify-content: space-between;">
          <div style="display:flex; align-items:center; gap:10px;">
              <div style="width: 8px; height: 8px; background: #34D399; border-radius: 50%; box-shadow: 0 0 10px #34D399;"></div>
              <div style="font-weight: 600; font-size: 14px;">Ania ‚Äì Asystentka NCNI</div>
          </div>
          <button id="ncni-close-btn" style="background:none; border:none; color: white; cursor: pointer; font-size: 18px; opacity: 0.8; transition: 0.2s;">&times;</button>
      </div>

      <div id="ncni-messages" style="flex: 1; padding: 15px; overflow-y: auto; color: #1E293B; font-size: 13px; display: flex; flex-direction: column; gap: 10px; background: #F8FAFC;">
          <div style="background: white; border: 1px solid #E2E8F0; padding: 12px 16px; border-radius: 12px 12px 12px 2px; align-self: flex-start; max-width: 85%; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
              <strong style="color: #0F766E;">Cze≈õƒá! Tu Ania üë©‚Äç‚öïÔ∏è</strong><br><br>Jestem Twoim przewodnikiem po ≈õwiecie neuroinnowacji w NCNI. Wspieram pacjent√≥w wiedzƒÖ opartƒÖ na badaniach dr. Kraszewskiego i standardach EBM.<br><br>Jak mogƒô Ci pom√≥c w temacie ADHD, diagnozy lub terapii VR?
          </div>
      </div>

      <div style="padding: 15px; border-top: 1px solid #E2E8F0; display: flex; gap: 8px; background: white;">
          <input id="ncni-input" type="text" placeholder="Zapytaj Aniƒô..." style="flex: 1; background: #F1F5F9; border: 1px solid #CBD5E1; border-radius: 99px; padding: 12px 18px; color: #334155; font-size: 13px; outline: none; transition: 0.2s;">
          <button id="ncni-send-btn" style="background: #0F766E; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
          </button>
      </div>
  </div>
</div>

<script>
(function() {
  // --- TU WKLEJ KLUCZ API ---
  const API_KEY = "TU_WKLEJ_SWOJ_KLUCZ_API"; 
  
  // BAZA WIEDZY ANI (WERSJA PE≈ÅNA EBM + VR)
  const SYSTEM_INSTRUCTION = `
  Jeste≈õ Ania, wirtualna asystentka w NCNI (Naukowe Centrum Neuroinnowacji) we Wroc≈Çawiu.
  Twoim celem jest edukacja i wstƒôpny tria≈º pacjent√≥w.

  AUTORYTET I NAUKA:
  Wszystkie metody stosowane w NCNI opierajƒÖ siƒô na twardych dowodach naukowych (EBM - Evidence Based Medicine).
  Gwarantem jako≈õci merytorycznej i technologicznej jest **dr hab. in≈º. Sebastian Kraszewski** (Dyrektor Naukowy). To on czuwa nad tym, by innowacje (VR, Biofeedback) by≈Çy skuteczne klinicznie.

  BAZA WIEDZY O VR W ADHD (Twoje g≈Ç√≥wne argumenty):
  W NCNI VR to nie gad≈ºet, ale "bezpieczne laboratorium uwagi". G≈Ç√≥wne korzy≈õci:
  1. Realizm: Trening w wirtualnej klasie/biurze, a nie przy kartce papieru (wysoka trafno≈õƒá ekologiczna).
  2. Zaanga≈ºowanie: Grywalizacja sprawia, ≈ºe dzieci CHCƒÑ ƒáwiczyƒá (wiƒôkszy compliance).
  3. Bezpiecze≈Ñstwo: Mo≈ºliwo≈õƒá pope≈Çniania b≈Çƒôd√≥w bez wstydu i oceny spo≈Çecznej (redukcja lƒôku).
  4. Precyzja: Obiektywne dane o czasie reakcji i b≈Çƒôdach (lepsze ni≈º subiektywna ocena).
  5. Trening Funkcji Wykonawczych: ƒÜwiczenie planowania, hamowania impuls√≥w (Go/No-Go) i pamiƒôci roboczej.
  6. Wsparcie farmakoterapii: VR ≈õwietnie uzupe≈Çnia leki, wykorzystujƒÖc okno lepszej koncentracji do nauki nawyk√≥w.

  PODEJ≈öCIE DO PSYCHOLOGII (Standard Ameryka≈Ñski/EBM):
  - Na pytania o terapiƒô odpowiadaj zgodnie ze standardami APA (American Psychological Association).
  - Promujemy podej≈õcie multimodalne: Psychoterapia (CBT/TUS) + Farmakoterapia (je≈õli potrzebna) + Treningi Poznawcze (VR/Biofeedback).
  - Terapia w NCNI to nie tylko rozmowa, to "trening m√≥zgu".
  - Diagnoza w NCNI jest Z≈ÅOTYM STANDARDEM: ADOS-2 (autyzm), DIVA-5 + MOXO (ADHD).

  OFERTA W SKR√ìCIE:
  - Neuro-Immersja (Premium): Zero-Gravity + VR + Biofeedback (regeneracja dla manager√≥w/rodzic√≥w).
  - Psychotraumatologia: Praca z traumƒÖ (EMDR).
  - Fizjoterapia Somatyczna: Praca z cia≈Çem.

  Styl rozmowy: Empatyczny, profesjonalny, oparty na wiedzy, ale przystƒôpny.
  Kontakt: ul. ≈ªeromskiego 60/5a, Wroc≈Çaw. Tel: 600 608 333.
  `;

  const toggleBtn = document.getElementById('ncni-toggle-btn');
  const chatWindow = document.getElementById('ncni-chat-window');
  const closeBtn = document.getElementById('ncni-close-btn');
  const sendBtn = document.getElementById('ncni-send-btn');
  const input = document.getElementById('ncni-input');
  const messages = document.getElementById('ncni-messages');

  let isOpen = false;

  function toggleChat() {
      isOpen = !isOpen;
      chatWindow.style.display = isOpen ? 'flex' : 'none';
      toggleBtn.style.transform = isOpen ? 'scale(0.9)' : 'scale(1)';
      if(isOpen) {
          input.focus();
          // Efekt wej≈õcia
          chatWindow.style.opacity = '0';
          chatWindow.style.transform = 'translateY(20px) scale(0.95)';
          setTimeout(() => {
              chatWindow.style.opacity = '1';
              chatWindow.style.transform = 'translateY(0) scale(1)';
          }, 10);
      }
  }

  if(toggleBtn) toggleBtn.addEventListener('click', toggleChat);
  if(closeBtn) closeBtn.addEventListener('click', toggleChat);

  function addMessage(text, isUser) {
      const msg = document.createElement('div');
      msg.style.padding = '12px 16px';
      msg.style.maxWidth = '85%';
      msg.style.borderRadius = isUser ? '12px 12px 2px 12px' : '12px 12px 12px 2px';
      msg.style.background = isUser ? '#0F766E' : 'white';
      msg.style.color = isUser ? 'white' : '#1E293B';
      msg.style.border = isUser ? 'none' : '1px solid #E2E8F0';
      msg.style.boxShadow = isUser ? '0 4px 6px rgba(15, 118, 110, 0.2)' : '0 2px 4px rgba(0,0,0,0.05)';
      msg.style.alignSelf = isUser ? 'flex-end' : 'flex-start';
      msg.style.fontSize = '13px';
      msg.style.lineHeight = '1.5';
      
      let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong style="font-weight:700;">$1</strong>');
      formattedText = formattedText.replace(/\n/g, '<br>');
      msg.innerHTML = formattedText;
      
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
  }

  async function chatWithGemini(userText) {
      if (API_KEY === "TU_WKLEJ_SWOJ_KLUCZ_API" || API_KEY.length < 10) {
          addMessage("B≈ÅƒÑD: Brak klucza API. Skonfiguruj plik.", false);
          return;
      }

      addMessage(userText, true);
      input.value = '';
      input.disabled = true;
      
      const loading = document.createElement('div');
      loading.innerHTML = '<span style="display:inline-block; animation: pulse 1.5s infinite;">Ania pisze...</span>';
      loading.style.fontSize = '11px';
      loading.style.color = '#94a3b8';
      loading.style.marginLeft = '16px';
      messages.appendChild(loading);

      try {
          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                  contents: [
                      { role: "user", parts: [{ text: SYSTEM_INSTRUCTION + "\n\nPacjent pyta: " + userText }] }
                  ],
                  safetySettings: [
                    { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                  ]
              })
          });
          
          const data = await response.json();
          messages.removeChild(loading);

          if (!response.ok) {
              addMessage("Przepraszam, wystƒÖpi≈Ç b≈ÇƒÖd po≈ÇƒÖczenia z serwerem AI.", false);
              return;
          }

          if(data.candidates && data.candidates[0].content) {
              const aiText = data.candidates[0].content.parts[0].text;
              addMessage(aiText, false);
          } else {
              addMessage("Nie zrozumia≈Çam pytania, spr√≥buj inaczej.", false);
          }

      } catch (e) {
          messages.removeChild(loading);
          addMessage("Problem z po≈ÇƒÖczeniem internetowym.", false);
      }
      input.disabled = false;
      input.focus();
  }

  if(sendBtn) sendBtn.addEventListener('click', () => { if(input.value.trim()) chatWithGemini(input.value); });
  if(input) input.addEventListener('keypress', (e) => { if(e.key === 'Enter' && input.value.trim()) chatWithGemini(input.value); });
  
  // --- AUTO-OPEN (Tylko na stronie g≈Ç√≥wnej) ---
  // Otw√≥rz Aniƒô automatycznie po 2.5 sekundy
  setTimeout(() => {
      if(!isOpen) {
          toggleChat();
      }
  }, 2500);

})();
</script>

<style>
@keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
#ncni-input:focus { border-color: #0F766E; box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.1); }
#ncni-send-btn:hover { background: #0D5E57; transform: scale(1.05); }
#ncni-close-btn:hover { opacity: 1; transform: scale(1.1); }
</style>
