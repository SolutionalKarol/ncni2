<div id="ncni-ania-widget">
    <button id="ania-trigger-btn" aria-label="OtwÃ³rz czat z AniÄ…">
        <div class="ania-avatar-circle">
            <img src="ania.jpg" alt="Ania NCNI" onerror="this.src='https://ui-avatars.com/api/?name=Ania+NCNI&background=0F766E&color=fff'">
             <span class="ania-status-dot"></span>
        </div>
        <div class="ania-tooltip-start">Kliknij, aby porozmawiaÄ‡ ğŸ’¬</div>
    </button>

    <div id="ania-chat-window">
        <div class="ania-chat-header">
            <div class="header-details">
                <div class="header-avatar-small">
                    <img src="ania.jpg" onerror="this.src='https://ui-avatars.com/api/?name=A&background=fff&color=0F766E'">
                </div>
                <div>
                    <span class="assistant-name">Ania (NCNI AI)</span>
                    <span class="assistant-role">Neuro-Concierge</span>
                </div>
            </div>
            <button id="ania-close-btn" aria-label="Zamknij czat">âœ•</button>
        </div>
        
        <div id="ania-messages-area" class="ania-chat-body">
            </div>

        <div class="ania-chat-input-area">
            <input type="text" id="ania-user-input" placeholder="Zapytaj o adres, cennik, stres..." autocomplete="off">
            <button id="ania-send-btn">â¤</button>
        </div>
        
        <div class="ania-chips">
            <button class="chip" onclick="askAnia('Gdzie was znajdÄ™?')">ğŸ“ Adres</button>
            <button class="chip" onclick="askAnia('Ile to kosztuje?')">ğŸ’° Cennik</button>
            <button class="chip" onclick="askAnia('Mam ADHD')">ğŸ§  ADHD</button>
            <button class="chip" onclick="askAnia('Opowiedz ciekawostkÄ™')">ğŸ’¡ Ciekawostka</button>
        </div>
    </div>
</div>

<style>
    /* Zmienne */
    :root {
        --ania-primary: #0F766E; 
        --ania-secondary: #0d5e57;
        --ania-bg: #ffffff;
        --ania-msg-bot: #f1f5f9;
        --ania-msg-user: #0F766E;
        --ania-shadow: 0 12px 28px rgba(0, 0, 0, 0.2), 0 2px 4px rgba(15, 118, 110, 0.1);
    }

    #ncni-ania-widget {
        position: fixed; bottom: 30px; right: 30px; z-index: 10001;
        font-family: 'Inter', sans-serif;
    }

    /* --- TRIGGER BUTTON & AVATAR FIX --- */
    #ania-trigger-btn {
        background: none; border: none; cursor: pointer; padding: 0; position: relative;
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    #ania-trigger-btn:hover { transform: scale(1.08); }
    
    .ania-avatar-circle {
        width: 70px; height: 70px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: var(--ania-shadow);
        overflow: hidden; position: relative;
        background: var(--ania-secondary);
    }
    /* NAPRAWA "PISOOROWEGO" ZDJÄ˜CIA */
    .ania-avatar-circle img { 
        width: 100%; height: 100%; 
        object-fit: cover;        /* Kluczowe: wypeÅ‚nia kÃ³Å‚ko bez rozciÄ…gania */
        object-position: center top; /* Kluczowe: centruje na twarzy */
    }
    .ania-status-dot {
        position: absolute; bottom: 5px; right: 5px;
        width: 14px; height: 14px; background: #22c55e;
        border: 2px solid white; border-radius: 50%;
        animation: pulse-green 2s infinite;
    }

    .ania-tooltip-start {
        position: absolute; right: 85px; top: 50%; transform: translateY(-50%);
        background: white; padding: 6px 12px; border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-size: 0.85rem; color: #333;
        white-space: nowrap; opacity: 0; pointer-events: none; transition: 0.3s;
    }
    #ania-trigger-btn:hover .ania-tooltip-start { opacity: 1; transform: translateY(-50%) translateX(-5px); }

    /* --- OKNO CZATU --- */
    #ania-chat-window {
        position: absolute; bottom: 90px; right: 0;
        width: 360px; height: 520px;
        background: var(--ania-bg);
        border-radius: 20px;
        box-shadow: var(--ania-shadow);
        display: flex; flex-direction: column; overflow: hidden;
        opacity: 0; visibility: hidden;
        transform: translateY(20px) scale(0.95);
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    #ania-chat-window.ania-open { opacity: 1; visibility: visible; transform: translateY(0) scale(1); }

    /* Header */
    .ania-chat-header {
        background: linear-gradient(135deg, var(--ania-primary), var(--ania-secondary));
        color: white; padding: 16px;
        display: flex; justify-content: space-between; align-items: center;
    }
    .header-details { display: flex; align-items: center; gap: 10px; }
    .header-avatar-small { width: 32px; height: 32px; border-radius: 50%; overflow: hidden; border: 1px solid rgba(255,255,255,0.5); }
    .header-avatar-small img { width: 100%; height: 100%; object-fit: cover; }
    .assistant-name { font-weight: 700; font-size: 0.95rem; display: block; }
    .assistant-role { font-size: 0.75rem; opacity: 0.9; }
    #ania-close-btn { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; opacity: 0.8; }
    #ania-close-btn:hover { opacity: 1; }

    /* Body */
    .ania-chat-body { 
        flex: 1; padding: 16px; overflow-y: auto; background: #f8fafc;
        display: flex; flex-direction: column; gap: 12px;
    }

    /* Dymki wiadomoÅ›ci */
    .ania-msg {
        max-width: 85%; padding: 10px 14px; border-radius: 16px;
        font-size: 0.9rem; line-height: 1.5; position: relative;
        animation: slideUp 0.3s ease;
    }
    .ania-msg.bot {
        background: var(--ania-msg-bot); color: #333;
        border-bottom-left-radius: 4px; border: 1px solid #e2e8f0;
    }
    .ania-msg.user {
        background: var(--ania-msg-user); color: white;
        align-self: flex-end; border-bottom-right-radius: 4px;
    }

    /* Input & Chips */
    .ania-chips {
        padding: 8px 16px; display: flex; gap: 8px; overflow-x: auto;
        background: white; border-top: 1px solid #f1f5f9;
    }
    .chip {
        background: #f1f5f9; border: 1px solid #e2e8f0; padding: 6px 12px;
        border-radius: 99px; font-size: 0.75rem; cursor: pointer; white-space: nowrap;
        color: var(--ania-primary); font-weight: 500; transition: 0.2s;
    }
    .chip:hover { background: var(--ania-primary); color: white; }

    .ania-chat-input-area {
        padding: 12px; background: white; display: flex; gap: 8px; border-top: 1px solid #f1f5f9;
    }
    #ania-user-input {
        flex: 1; padding: 10px 16px; border-radius: 20px; border: 1px solid #cbd5e1;
        outline: none; font-size: 0.9rem;
    }
    #ania-user-input:focus { border-color: var(--ania-primary); }
    #ania-send-btn {
        width: 40px; height: 40px; border-radius: 50%; background: var(--ania-primary);
        color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
    }

    @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }

    /* Mobile Responsive */
    @media (max-width: 480px) {
        #ania-chat-window { width: calc(100vw - 40px); right: -10px; bottom: 80px; height: 60vh; }
    }
</style>

<script>
    // Global function for chips
    window.askAnia = function(question) {
        const input = document.getElementById('ania-user-input');
        input.value = question;
        document.getElementById('ania-send-btn').click();
    }

    document.addEventListener('DOMContentLoaded', () => {
        const widget = document.getElementById('ania-chat-window');
        const trigger = document.getElementById('ania-trigger-btn');
        const closeBtn = document.getElementById('ania-close-btn');
        const msgArea = document.getElementById('ania-messages-area');
        const input = document.getElementById('ania-user-input');
        const sendBtn = document.getElementById('ania-send-btn');

        // 1. Toggle Window
        const toggleChat = () => widget.classList.toggle('ania-open');
        trigger.addEventListener('click', toggleChat);
        closeBtn.addEventListener('click', toggleChat);

        // 2. Dodawanie wiadomoÅ›ci
        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.classList.add('ania-msg', sender);
            div.innerHTML = text;
            msgArea.appendChild(div);
            msgArea.scrollTop = msgArea.scrollHeight;
        }

        // 3. POWITANIE NA START
        setTimeout(() => {
            if (msgArea.children.length === 0) {
                addMessage(`
                    Witaj! ğŸ‘‹ Jestem Ania, Twoja wirtualna asystentka w Naukowym Centrum Neuroinnowacji.
                    <br><br>
                    ChÄ™tnie opowiem Ci o naszych innowacyjnych terapiach, sprawdzÄ™ cennik lub podpowiem, jak dojechaÄ‡.
                    <br><br>
                    <strong>W czym mogÄ™ pomÃ³c?</strong>
                `, 'bot');
            }
        }, 500);

        // 4. MÃ“ZG ANI - BAZA WIEDZY (Na podstawie Handbooka i Twoich plikÃ³w)
        function getBotResponse(userText) {
            const lower = userText.toLowerCase();

            // SÅ‚owa kluczowe
            if (lower.includes('adres') || lower.includes('gdzie') || lower.includes('dojazd') || lower.includes('ulic')) {
                return "Znajdziesz nas we WrocÅ‚awiu przy <b>ul. Stefana Å»eromskiego 60/5a</b>. ğŸ¢<br>Czekamy na Ciebie!";
            }
            
            if (lower.includes('cennik') || lower.includes('koszt') || lower.includes('cena') || lower.includes('pÅ‚atn')) {
                return "Oto przykÅ‚adowe ceny z naszego cennika:<br>ğŸ”¹ <b>NeuroStart (30 min)</b> - 190 PLN (idealne na poczÄ…tek)<br>ğŸ”¹ <b>GÅ‚Ä™bia Spokoju (90 min)</b> - 640 PLN<br>ğŸ”¹ <b>Terapia VR/Biofeedback</b> - pakiety od 150 PLN/sesja.<br><br>PeÅ‚ny cennik dostÄ™pny w recepcji.";
            }

            if (lower.includes('adhd') || lower.includes('skupienie') || lower.includes('koncentrac')) {
                return "Specjalizujemy siÄ™ w neurorÃ³Å¼norodnoÅ›ci! ğŸ§ <br>Dla ADHD polecamy treningi <b>Focus & Flow</b> w VR oraz Biofeedback HRV. To nauka skupienia poprzez grÄ™, w bezpiecznym Å›rodowisku ND-affirming.";
            }

            if (lower.includes('stres') || lower.includes('nerw') || lower.includes('spokÃ³j')) {
                return "Rozumiem. Na wysoki poziom stresu rekomendujÄ™ sesjÄ™ <b>NeuroSanctum</b> w fotelu Zero-Gravity. ğŸŒŒ<br>To caÅ‚kowite odciÄ…Å¼enie krÄ™gosÅ‚upa i wyciszenie ukÅ‚adu nerwowego. JuÅ¼ 20 minut dziaÅ‚a jak gÅ‚Ä™boka drzemka.";
            }

            if (lower.includes('ciekawostka') || lower.includes('wiedza') || lower.includes('coÅ› ciekawego')) {
                const facts = [
                    "ğŸ’¡ <b>Czy wiesz, Å¼e?</b> 20 minut w pozycji Zero-Gravity regeneruje krÄ™gosÅ‚up tak, jak kilka godzin snu.",
                    "ğŸ’¡ <b>Ciekawostka:</b> Nasz mÃ³zg zuÅ¼ywa aÅ¼ 20% energii caÅ‚ego ciaÅ‚a. Dlatego 'brain fog' jest tak mÄ™czÄ…cy!",
                    "ğŸ’¡ <b>Nauka:</b> Biofeedback pozwala Ci zobaczyÄ‡ na ekranie pracÄ™ wÅ‚asnego serca i nauczyÄ‡ siÄ™ niÄ… sterowaÄ‡ oddechem."
                ];
                return facts[Math.floor(Math.random() * facts.length)];
            }
            
            if (lower.includes('kontakt') || lower.includes('telefon')) {
                return "Skontaktuj siÄ™ z nami:<br>ğŸ“ <b>600 608 333</b><br>âœ‰ï¸ kontakt@ncni.pl";
            }

            // Fallback
            return "To ciekawe pytanie! ğŸ¤” Jako wirtualna asystentka wciÄ…Å¼ siÄ™ uczÄ™. Najlepiej bÄ™dzie, jeÅ›li zadzwonisz do Karoliny lub Sebastiana pod numer <b>600 608 333</b>, a oni rozwiejÄ… wszelkie wÄ…tpliwoÅ›ci.";
        }

        // 5. ObsÅ‚uga wysyÅ‚ania
        function handleSend() {
            const text = input.value.trim();
            if (!text) return;

            addMessage(text, 'user');
            input.value = '';

            // Symulacja "pisania"
            setTimeout(() => {
                const response = getBotResponse(text);
                addMessage(response, 'bot');
            }, 600);
        }

        sendBtn.addEventListener('click', handleSend);
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSend();
        });
    });
</script>
