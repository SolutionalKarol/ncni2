<div id="ncni-widget-container" style="font-family: 'Inter', sans-serif; z-index: 9999; position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; align-items: flex-end;">
    
  <button id="ncni-toggle-btn" style="background: #0F766E; border: none; width: 60px; height: 60px; border-radius: 50%; box-shadow: 0 10px 25px rgba(15, 118, 110, 0.4); cursor: pointer; transition: transform 0.2s; display: flex; align-items: center; justify-content: center;">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 6C13.66 6 15 7.34 15 9C15 10.66 13.66 12 12 12C10.34 12 9 10.66 9 9C9 7.34 10.34 6 12 6ZM12 20C9.33 20 7 18 7 15C7 14 9.33 12 12 12C14.67 12 17 14 17 15C17 18 14.67 20 12 20Z" fill="#ffffff"/>
      </svg>
  </button>

  <div id="ncni-chat-window" style="display: none; width: 350px; height: 500px; background: rgba(255, 255, 255, 0.98); border: 1px solid #E2E8F0; border-radius: 18px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.2); margin-bottom: 16px; flex-direction: column;">
      
      <div style="background: #0F766E; padding: 15px; color: white; display: flex; align-items: center; justify-content: space-between;">
          <div style="font-weight: 600; font-size: 14px;">Asystent Kliniczny NCNI</div>
          <button id="ncni-close-btn" style="background:none; border:none; color: white; cursor: pointer; font-size: 18px;">&times;</button>
      </div>

      <div id="ncni-messages" style="flex: 1; padding: 15px; overflow-y: auto; color: #1E293B; font-size: 13px; display: flex; flex-direction: column; gap: 10px; background: #F8FAFC;">
          <div style="background: white; border: 1px solid #E2E8F0; padding: 10px 14px; border-radius: 12px 12px 12px 2px; align-self: flex-start; max-width: 85%; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
              Dzień dobry. Jestem wirtualnym asystentem NCNI. Pomogę dobrać ścieżkę diagnostyczną lub terapeutyczną (stres, ADHD, trauma). W czym mogę pomóc?
          </div>
      </div>

      <div style="padding: 15px; border-top: 1px solid #E2E8F0; display: flex; gap: 8px; background: white;">
          <input id="ncni-input" type="text" placeholder="Np. szukam diagnozy ADHD..." style="flex: 1; background: #F1F5F9; border: 1px solid #CBD5E1; border-radius: 99px; padding: 10px 16px; color: #334155; font-size: 13px; outline: none;">
          <button id="ncni-send-btn" style="background: #0F766E; color: white; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">&uarr;</button>
      </div>
  </div>
</div>

<script>
(function() {
  const API_KEY = "TU_WKLEJ_SWOJ_KLUCZ_API"; 
  
  // Zaktualizowana "Medyczna" Instrukcja
  const SYSTEM_INSTRUCTION = `
  Jesteś asystentem klinicznym w NCNI (Naukowe Centrum Neuroinnowacji) we Wrocławiu.
  Twój styl komunikacji: Profesjonalny, empatyczny, konkretny, medyczny (EBM - Evidence Based Medicine).
  Unikaj marketingowego żargonu typu "magiczna podróż". Używaj terminów: "regulacja układu nerwowego", "neuroplastyczność", "trening funkcji wykonawczych".

  OFERTA KLINICZNA (Na podstawie strony NCNI):

  1. DIAGNOSTYKA (Standard Medyczny):
     - Diagnoza ADHD (Dorośli/Dzieci): Wywiad kliniczny (DIVA-5), testy komputerowe (MOXO), obserwacja, raport końcowy.
     - Diagnoza Spektrum Autyzmu (ASD): Złoty standard ADOS-2, zespół psycholog + psychiatra.

  2. NEURO-IMMERSJA KLINICZNA (To jest to "Hyper Premium" rozwiązanie):
     - Co to jest: Zaawansowana procedura regulacji układu nerwowego łącząca trzy technologie w jednym czasie.
     - Składniki: Fotel Zero-Gravity (całkowite odciążenie kręgosłupa i układu ruchu) + Terapia VR (kontrolowana immersja wizualna) + Biofeedback HRV (monitoring fizjologiczny na żywo).
     - Cel: Głęboka redukcja kortyzolu, "reset" przebodźcowania, trening koherencji serca.
     - Dla kogo: Przewlekły stres, stany lękowe, wysokie napięcie mięśniowe, potrzeba szybkiej regeneracji (np. kadra zarządzająca).
     - Nazwa w systemie: "Protokół Neuro-Immersji Zintegrowanej".

  3. TERAPIE SPECJALISTYCZNE:
     - Psychotraumatologia: Praca z traumą (EMDR, Somatic Experiencing).
     - Treningi ADHD/ASD: Trening funkcji wykonawczych, TUS (Trening Umiejętności Społecznych) w VR.
     - Fizjoterapia Somatyczna: Praca z napięciami psychosomatycznymi w ciele.
     - Dietetyka Kliniczna: Oś jelito-mózg (wsparcie w ADHD/ASD/Depresji).

  ZASADY:
  - Jeśli klient pyta o relaks, proponuj "Protokół Neuro-Immersji" jako najbardziej zaawansowaną formę regeneracji.
  - Jeśli klient pyta o diagnozę, kieruj na ścieżkę diagnostyczną (ADHD/ASD).
  - Kontakt i adres: ul. Żeromskiego 60/5a, Wrocław. Tel: 600 608 333.
  `;

  const toggleBtn = document.getElementById('ncni-toggle-btn');
  const chatWindow = document.getElementById('ncni-chat-window');
  const closeBtn = document.getElementById('ncni-close-btn');
  const sendBtn = document.getElementById('ncni-send-btn');
  const input = document.getElementById('ncni-input');
  const messages = document.getElementById('ncni-messages');

  let isOpen = false;

  toggleBtn.addEventListener('click', () => {
      isOpen = !isOpen;
      chatWindow.style.display = isOpen ? 'flex' : 'none';
      if(isOpen) input.focus();
  });
  closeBtn.addEventListener('click', () => {
      isOpen = false;
      chatWindow.style.display = 'none';
  });

  function addMessage(text, isUser) {
      const msg = document.createElement('div');
      msg.style.padding = '10px 14px';
      msg.style.maxWidth = '85%';
      msg.style.borderRadius = isUser ? '12px 12px 2px 12px' : '12px 12px 12px 2px';
      msg.style.background = isUser ? '#0F766E' : 'white';
      msg.style.color = isUser ? 'white' : '#1E293B';
      msg.style.border = isUser ? 'none' : '1px solid #E2E8F0';
      msg.style.boxShadow = isUser ? '0 4px 6px rgba(15, 118, 110, 0.2)' : '0 2px 4px rgba(0,0,0,0.05)';
      msg.style.alignSelf = isUser ? 'flex-end' : 'flex-start';
      msg.innerText = text;
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
  }

  async function chatWithGemini(userText) {
      addMessage(userText, true);
      input.value = '';
      input.disabled = true;
      
      const loading = document.createElement('div');
      loading.innerText = 'Analizuję zapytanie...';
      loading.style.fontSize = '11px';
      loading.style.color = '#94a3b8';
      loading.style.marginLeft = '10px';
      messages.appendChild(loading);

      try {
          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                  contents: [
                      { role: "user", parts: [{ text: SYSTEM_INSTRUCTION + "\n\nKlient pyta: " + userText }] }
                  ]
              })
          });
          
          const data = await response.json();
          messages.removeChild(loading);

          if(data.candidates && data.candidates[0].content) {
              const aiText = data.candidates[0].content.parts[0].text;
              addMessage(aiText, false);
          } else {
              addMessage("Błąd systemu AI. Spróbuj ponownie.", false);
          }

      } catch (e) {
          messages.removeChild(loading);
          addMessage("Problem z połączeniem.", false);
      }
      input.disabled = false;
      input.focus();
  }

  sendBtn.addEventListener('click', () => { if(input.value.trim()) chatWithGemini(input.value); });
  input.addEventListener('keypress', (e) => { if(e.key === 'Enter' && input.value.trim()) chatWithGemini(input.value); });

})();
</script>
